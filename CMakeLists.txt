cmake_minimum_required(VERSION 3.20)
project(win-capture-audio VERSION 2.1.0)

set(PLUGIN_AUTHOR "bozbez")
set(RELEASE_DIR "${PROJECT_SOURCE_DIR}/release")

if(CMAKE_SIZEOF_VOID_P EQUAL 8)
    set(ARCH_NAME "64bit")
else()
    set(ARCH_NAME "32bit")
endif()

configure_file(
    installer/installer.iss.in
    ../installer/installer.generated.iss
)

find_package(LibObs REQUIRED)

set(win-capture-audio_HEADERS
    src/common.h
    src/format-conversion.h
    src/audio-capture.h
    src/obfuscate.h
    src/window-helpers.h
    src/audio-capture-helper.h)

set(win-capture-audio_SOURCES
    src/plugin.cpp
    src/audio-capture.cpp
    src/obfuscate.cpp
    src/window-helpers.cpp
    src/audio-capture-helper.cpp)

add_library(win-capture-audio MODULE ${win-capture-audio_SOURCES} ${win-capture-audio_HEADERS})
target_link_libraries(win-capture-audio libobs dwmapi psapi ksuser mmdevapi mfplat)

set_property(TARGET win-capture-audio PROPERTY CXX_STANDARD 20)
target_include_directories(win-capture-audio PUBLIC ${CMAKE_SOURCE_DIR}/deps/wil/include)

install_obs_plugin_with_data(win-capture-audio data)
